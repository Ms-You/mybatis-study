<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Review">
    <resultMap id="reviewResultMap" type="com.mybatis.board.vo.ReviewVO">
        <id property="reviewId" column="review_id" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="storeName" column="store_name" />
        <result property="region" column="region" />
        <result property="memberId" column="member_id" />
        <!-- 지연 로딩 -->
        <association property="receiptImageVO" javaType="com.mybatis.board.vo.ReceiptImageVO" column="review_id" select="ReceiptImage.selectReceiptImageByReviewId" />
        <collection property="reviewImageVOList" ofType="com.mybatis.board.vo.ReviewImageVO" column="review_id" select="ReviewImage.selectReviewImageByReviewId" />
        <collection property="commentVOList" ofType="com.mybatis.board.vo.CommentVO" column="review_id" select="Comment.selectCommentByReviewId" />
    </resultMap>

    <select id="selectReviewById" resultMap="reviewResultMap" parameterType="long">
        SELECT review_id, title, content, store_name, region, member_id
        FROM review
        WHERE review_id = #{reviewId}
    </select>

    <select id="selectReviewByMemberId" resultMap="reviewResultMap" parameterType="long">
        SELECT review_id, title, content, store_name, region, member_id
        FROM review
        WHERE member_id = #{memberId}
    </select>

    <insert id="saveReview" parameterType="com.mybatis.board.vo.ReviewVO">
        INSERT INTO review (title, content, store_name, region, member_id)
        VALUES (#{title}, #{content}, #{storeName}, #{region}, #{memberId})
    </insert>
</mapper>